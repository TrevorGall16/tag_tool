Document 1: Project Overview (TagArchitect — FINAL & COMPLETE)

## 1. Project Type

Micro-SaaS Batch Processing Utility. (Framework: Next.js).

## 2. One-Sentence Summary

A browser-native workflow tool for Etsy and Adobe Stock sellers that uses local AI clustering and cloud-based AI Vision to package digital assets into verified, marketplace-ready ZIP and CSV files.

## 3. Core Purpose

To automate the 3-hour manual labor of product listing into a 10-minute "Review & Export" workflow, ensuring 100% compliance with marketplace SEO rules while keeping server costs near zero.

## 4. Target Users

High-Volume Vendors: Sellers on Etsy and Adobe Stock who upload 50–500 items per batch and require high-precision metadata to maintain their search ranking.

---

## 5. Feature List (Input → Output)

### 5.1 Resilient Batch Uploader

**Input:** Multi-file drag-and-drop (JPG, PNG only).

**Logic:** Rejects non-images. Marks files >100MB with a Red Badge; user must remove/replace to proceed.

### 5.2 AI Clustering (Free Phase)

**Engine:** clip-vit-base-patch32 (Runs locally in-browser via ONNX.js).

**Model Size:** ~150MB

**First-Time Load:**

- Show modal: "Downloading AI model (150MB)... [Progress Bar]"
- Cache model in browser IndexedDB after download
- Subsequent loads: Load from cache (2-3 seconds)

**Clustering Logic:**

- Groups images with >0.75 cosine similarity
- Processing time: ~5-10 seconds for 50 images, ~30-40 seconds for 200 images
- Show progress: "Analyzing image 25/50..."

**Edge Case:** If no similarity >0.75 is found, each image becomes its own group.

### 5.3 AI Tagging (Paid Phase)

**Input:** One representative image per group sent to Claude Vision API.

**Output:** Titles and Tags for the entire group (all images in group inherit these tags).

**API Rate Limiting:**

- Claude Vision API has rate limits (~50 requests/minute)
- Process images sequentially with 1.2-second delay between requests
- If 429 error (rate limit): Wait 60 seconds, show "API rate limit reached. Retrying in 60 seconds...", then retry
- If API timeout (>30 seconds): Mark image as "Failed", allow user to retry manually

### 5.4 Manual Override UI

**Interactions:**

- Drag images between groups
- "+ New Group" button (creates empty group)
- "Delete Group" button (moves images to "Ungrouped" section)

**Restriction:** Group names are auto-generated (Group 1, Group 2, etc.) and cannot be renamed by user.

**Group-Level Editing:** User can click "Edit Group Tags" → all images in that group inherit the edited tags.

### 5.5 Marketplace Export Engine

**CSV Generation Logic:**

- Each IMAGE gets its own CSV row (not one row per group)
- All images in a group share the same tags by default
- If user manually edits tags for a specific image, only that image's CSV row changes

**Example:**

- Group 1 has 3 images: beach-1.jpg, beach-2.jpg, beach-3.jpg
- Group 1 AI tags: "sunset, ocean, waves"
- CSV Output:
  ```
  Row 1: beach-1.jpg | "Sunset Beach Scene" | "sunset, ocean, waves"
  Row 2: beach-2.jpg | "Sunset Beach Scene" | "sunset, ocean, waves"
  Row 3: beach-3.jpg | "Sunset Beach Scene" | "sunset, ocean, waves"
  ```
- If user edits beach-2.jpg tags to "ocean, twilight, calm":
  ```
  Row 1: beach-1.jpg | "Sunset Beach Scene" | "sunset, ocean, waves"
  Row 2: beach-2.jpg | "Sunset Beach Scene" | "ocean, twilight, calm"
  Row 3: beach-3.jpg | "Sunset Beach Scene" | "sunset, ocean, waves"
  ```

**Adobe Stock Format:**

- Columns: Filename, Title, Keywords
- Title: Max 200 characters
- Keywords: Max 49 keywords, comma-separated, no quotes
- If AI generates >49 tags: Auto-truncate to top 49 by relevance

**Etsy Format:**

- Columns: Title, Tags, Image1
- Title: Max 140 characters
- Tags: Max 13 tags, comma-separated
- Tag Length: Max 20 characters per tag
- If AI generates tag >20 chars: Truncate to 20 chars, show yellow warning badge
- If AI generates <5 tags: Show "Add More Tags Manually" prompt

---

## 6. Monetization Model

### 6.1 Credit Definition

**1 Credit = 1 Image Tagged by AI**

Clustering is FREE (runs in browser, no API cost).

### 6.2 Pricing Tiers

- **Free:** 10 credits (Session-based, no account required)
- **Starter:** €12/month = 200 credits (Account-based, auto-renews)
- **Pro:** €29/month = 1,000 credits (Account-based, auto-renews)

### 6.3 Paywall Location

Triggered when the user clicks **"Generate AI Tags"** button.

**Flow:**

1. User uploads 50 images → Clustering happens automatically (FREE, no credits consumed)
2. User sees grouped images with NO tags yet
3. User clicks "Generate AI Tags" → Credit check modal appears
4. If user has <50 credits → Show "Buy More Credits" modal with upgrade options
5. If user has ≥50 credits → AI generates tags → 50 credits deducted

### 6.4 Credit Display

Always visible in top-right corner of dashboard: "Credits: 150 remaining"

---

## 7. Constraints & Error Recovery

### 7.1 File Renaming

**Sanitization:** Remove illegal characters `/\:*?"<>|`. Replace spaces with hyphens.

**Deduplication:** If two images share a title, append counter:

- `sunset-beach.jpg`
- `sunset-beach-2.jpg`
- `sunset-beach-3.jpg`

### 7.2 Metadata Persistence

**Duration:** 24 hours from upload timestamp.

**Storage Strategy:**

- **Anonymous users (not logged in):** Browser localStorage only (no cross-device access)
- **Logged-in users (free or paid):** Database (cross-device access)
- **Ads:** Anonymous + logged-in free users see ads in dashboard. Paid users get ad-free experience.

**After 24 Hours:** Metadata auto-deleted from both localStorage and database.

**Manual Delete:** "Clear All Data" button in dashboard (immediate deletion).

### 7.3 Error Messages (Exact User-Facing Text)

- **File Too Large:** "File exceeds 100MB. Please compress or remove."
- **Invalid File Type:** "Only JPG and PNG files are supported."
- **AI API Failure:** "AI tagging failed for this image. Click 'Retry' or add tags manually."
- **Retry Fails (3x):** "Unable to process this image. You can still export without it."
- **Credit Depletion:** "You need X more credits to tag Y images. [Buy Credits]"
- **Rate Limit Hit:** "API rate limit reached. Retrying in 60 seconds..."
- **API Timeout:** "Request timed out. Click 'Retry' to try again."

### 7.4 ZIP Logic

**If ZIP > 500MB:** Automatically split into multiple files:

- `TagArchitect_Export_Part1.zip`
- `TagArchitect_Export_Part2.zip`

Each ZIP contains a subset of renamed images + corresponding CSV rows.

---

## 8. User Flow (The "Happy Path")

1. **Upload:** User drags 50 JPGs into the browser
2. **Model Load (First Time):** "Downloading AI model (150MB)... 47%" → Cached for future use
3. **Clustering:** System runs CLIP locally → "Analyzing image 25/50..." → User sees images automatically grouped (No tags yet)
4. **Manual Adjust:** User drags a "misplaced" image into the correct group
5. **Paywall:** User clicks "Generate AI Tags" → System checks credits → "50 credits will be used. Continue?" → User confirms → 50 credits deducted
6. **AI Processing:** Progress bar shows "Generating tags for Group 1/5..." (sequential processing with rate limit handling)
7. **Review:** Verification table fills with AI tags → User spot-checks for hallucinations or errors
8. **Export:** User selects "Etsy" from dropdown → Clicks "Export" button
9. **Download:** Browser downloads `TagArchitect_Export.zip` containing renamed images + Etsy-formatted CSV
10. **Success:** Toast notification: "Export complete! 100 credits remaining."

---

## 9. Out of Scope (V1 — Do Not Build)

- ❌ Video or 3D file support (images only)
- ❌ Batch History / Saved Projects (user can only work on ONE batch at a time)
- ❌ Direct API uploads to marketplaces (CSV export only, manual upload to Etsy/Adobe Stock)
- ❌ AI-generated descriptions (titles and tags only)
- ❌ Team collaboration features (single-user tool)
- ❌ Mobile app (web-only)
- ❌ Bulk editing across multiple batches
- ❌ Custom CSV column mapping (Adobe Stock and Etsy formats only)

* 9.1 Required Root Files (Post-Launch)
* - /public/robots.txt (allow all, link to sitemap)
* - /public/sitemap.xml (auto-generated, list /dashboard route only)
* - No ads.txt needed (no AdSense for this project)

---

## 10. Success Criteria

### 10.1 Performance

- Lighthouse Performance Score: >90
- CLIP model caching: 100% success rate (model loads from IndexedDB on subsequent visits)

### 10.2 Error Recovery

- Partial batch failure: 100% success rate (if 2/100 images fail, 98 still process correctly)
- API rate limit handling: Zero user-facing crashes (automatic retry with clear messaging)

### 10.3 Revenue Readiness

- Credit system functional: Users cannot generate tags without sufficient credits
- Payment integration ready: "Buy Credits" flow redirects to payment page (implementation details in Payment.md)

---

## 11. Technical Notes for Builder AI

### 11.1 Builder Liberty

The Builder AI has liberty to improve technical implementation if a guideline is inefficient, **as long as**:

1. User experience is not degraded
2. Core business logic (credits, CSV format, file naming) remains intact
3. Cost constraints are respected (thumbnail resizing, client-side clustering)

### 11.2 Partial Failure Protocol

If 100 images are uploaded and 2 are invalid/too large:

- ✅ Accept the 98 good files
- ✅ Highlight the 2 bad files with red badges
- ✅ Prompt user to "Remove or Replace" them
- ❌ DO NOT fail the entire batch

### 11.3 Workflow Continuity

The website must NEVER reset or lose progress if one specific file fails. State must be preserved in:

- Browser memory (for current session)
- localStorage (for free users returning within 24 hours)
- Database (for paid users across devices)

### 11.4 Deployment Platform

This application is designed for **Netlify** deployment. Key considerations:

- Use Netlify Scheduled Functions for 24-hour cleanup cron job (not Vercel cron)
- CLIP model (150MB) must be committed to repo or uploaded to Netlify CDN
- Environment variables set via Netlify Dashboard or CLI

---

**End of Overview Document**

**Next Documents Required:**

- TechStack.md (Framework, database, hosting, libraries)
- Authentication.md (Signup, login, session management)
- Payment.md (Stripe integration, webhook handling)
- Database.md (Schema, relationships, migrations)
- UI.md (Component tree, state management, design system)
- API.md (Claude Vision integration, error handling)
- Deployment.md (Environment setup, deployment steps)
